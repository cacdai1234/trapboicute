<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Y√™u C·∫ßu Quy·ªÅn Truy C·∫≠p</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #1e3c72, #2a5298);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    #requestAccess, #adminPanel, #content {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      max-width: 400px;
      text-align: center;
      user-select: none;
    }
    #requestAccess {
      display: block;
    }
    #adminPanel {
      display: none;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    button {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #fcd34d;
      color: #000;
      margin-top: 15px;
      user-select: none;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #eab308;
    }
    .access-item {
      background: rgba(255,255,255,0.2);
      margin: 5px 0;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      word-break: break-word;
    }
    .access-ip {
      flex: 1;
      text-align: left;
    }
    .approve-btn {
      background: #22c55e;
      color: white;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    .approve-btn:hover {
      background: #16a34a;
    }
    #content {
      display: none;
      max-width: 500px;
      padding: 2rem;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      color: #fcd34d;
    }
    .heart {
      font-size: 2rem;
      margin-top: 1rem;
      color: #f43f5e;
    }
  </style>
</head>
<body>

  <!-- N√∫t y√™u c·∫ßu quy·ªÅn truy c·∫≠p -->
  <div id="requestAccess">
    <h2>üîí Y√äU C·∫¶U QUY·ªÄN TRUY C·∫¨P</h2>
    <button id="requestBtn">G·ª≠i y√™u c·∫ßu</button>
    <p><small>Nh·∫•n n√∫t ƒë·ªÉ g·ª≠i y√™u c·∫ßu truy c·∫≠p. Admin s·∫Ω duy·ªát trong th·ªùi gian s·ªõm nh·∫•t.</small></p>
  </div>

  <!-- B·∫£ng ph√™ duy·ªát c·ªßa Admin (·∫©n m·∫∑c ƒë·ªãnh, hi·ªán khi nh·∫•n P) -->
  <div id="adminPanel">
    <h3>üìã B·∫£ng ph√™ duy·ªát truy c·∫≠p</h3>
    <div id="requestsList"></div>
    <p><small>Nh·∫•n ph√≠m P ƒë·ªÉ ·∫©n/hi·ªán b·∫£ng n√†y.</small></p>
  </div>

  <!-- N·ªôi dung xin l·ªói (hi·ªán khi ƒë∆∞·ª£c ph√™ duy·ªát) -->
  <div id="content">
    <h1>  Anh Xin l·ªói...</h1>
    <p>
      Anh xin l·ªói v√¨ chuy·ªán h√¥m n·ªç nh√©. Anh kh√¥ng c·ªë √Ω ƒë√¢u, t·∫°i anh v√¥ t√¢m qu√°. Mong em ƒë·ª´ng bu·ªìn n·ªØa nha!<br>
      Anh xin l·ªói v√¨ ƒë√£ l√†m em bu·ªìn. Anh nh·∫≠n bi·∫øt ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥ l√† sai r·ªìi ..!
    </p>
    <div class="heart"> no leak please</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // C·∫•u h√¨nh Firebase (thay b·∫±ng c·ªßa b·∫°n)
    const firebaseConfig = {
      apiKey: "AIzaSyCtJtabQIwEl_lUO8vIpeQgp4OyMtcXjkw",
      authDomain: "login-a2878.firebaseapp.com",
      databaseURL: "https://login-a2878-default-rtdb.firebaseio.com",
      projectId: "login-a2878",
      storageBucket: "login-a2878.firebasestorage.app",
      messagingSenderId: "312148809641",
      appId: "1:312148809641:web:c77b295ada290ecc9156b8",
      measurementId: "G-7DRBRBRJHL"
    };

    // Kh·ªüi t·∫°o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const requestBtn = document.getElementById("requestBtn");
    const requestAccessDiv = document.getElementById("requestAccess");
    const adminPanel = document.getElementById("adminPanel");
    const requestsList = document.getElementById("requestsList");
    const contentDiv = document.getElementById("content");

    // L∆∞u IP ng∆∞·ªùi d√πng, tr·∫°ng th√°i duy·ªát
    let userIP = null;
    let userKey = null; // key trong Firebase ƒë·ªÉ theo d√µi

    // L·∫•y IP ng∆∞·ªùi d√πng qua api.ipify.org
    async function getUserIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch {
        return "0.0.0.0";
      }
    }

    // G·ª≠i IP l√™n Firebase v√† Discord webhook
    async function sendRequest(ip) {
      // T·∫°o key m·ªõi trong DB
      const newKey = db.ref('requests').push().key;

      // Ghi request v·ªõi tr·∫°ng th√°i pending (ch∆∞a duy·ªát)
      await db.ref('requests/' + newKey).set({
        ip: ip,
        approved: false,
        timestamp: Date.now()
      });

      userKey = newKey;

      // G·ª≠i webhook Discord
      const webhookURL = "https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN"; // Thay webhook th·∫≠t v√†o ƒë√¢y
      const content = {
        content: `üì¢ Ng∆∞·ªùi d√πng y√™u c·∫ßu truy c·∫≠p:\nIP: ${ip}\nTh·ªùi gian: ${new Date().toLocaleString()}`
      };
      try {
        await fetch(webhookURL, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(content)
        });
      } catch(e) {
        console.warn("Kh√¥ng g·ª≠i ƒë∆∞·ª£c webhook", e);
      }
    }

    // Hi·ªÉn th·ªã y√™u c·∫ßu truy c·∫≠p (admin)
    function renderRequests(data) {
      requestsList.innerHTML = "";
      if (!data) return;
      Object.entries(data).forEach(([key, val]) => {
        if (val.approved) return; // Kh√¥ng hi·ªán request ƒë√£ duy·ªát
        const div = document.createElement("div");
        div.className = "access-item";

        const spanIP = document.createElement("div");
        spanIP.className = "access-ip";
        spanIP.textContent = val.ip;

        const btnApprove = document.createElement("button");
        btnApprove.className = "approve-btn";
        btnApprove.textContent = "Ph√™ duy·ªát";
        btnApprove.onclick = () => {
          db.ref('requests/' + key).update({ approved: true });
        };

        div.appendChild(spanIP);
        div.appendChild(btnApprove);
        requestsList.appendChild(div);
      });
    }

    // Ki·ªÉm tra tr·∫°ng th√°i duy·ªát c·ªßa user
    function watchApproval(key) {
      if (!key) return;
      const ref = db.ref('requests/' + key + '/approved');
      ref.on('value', snapshot => {
        if (snapshot.val() === true) {
          // ƒê∆∞·ª£c ph√™ duy·ªát
          requestAccessDiv.style.display = "none";
          contentDiv.style.display = "block";
        }
      });
    }

    // X·ª≠ l√Ω n√∫t y√™u c·∫ßu quy·ªÅn
    requestBtn.onclick = async () => {
      if (userKey) {
        alert("B·∫°n ƒë√£ g·ª≠i y√™u c·∫ßu r·ªìi, vui l√≤ng ch·ªù admin ph√™ duy·ªát.");
        return;
      }
      userIP = await getUserIP();
      await sendRequest(userIP);
      watchApproval(userKey);
      alert("ƒê√£ g·ª≠i y√™u c·∫ßu, vui l√≤ng ch·ªù admin ph√™ duy·ªát.");
    };

    // Admin nh·∫•n ph√≠m P ƒë·ªÉ b·∫≠t/t·∫Øt b·∫£ng ph√™ duy·ªát
    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === 'p') {
        if (adminPanel.style.display === "none") {
          adminPanel.style.display = "block";
        } else {
          adminPanel.style.display = "none";
        }
      }
    });

    // L·∫Øng nghe thay ƒë·ªïi requests realtime (d√†nh cho admin)
    db.ref('requests').on('value', snapshot => {
      renderRequests(snapshot.val());
    });

  </script>

</body>
</html>
