<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>YÃªu Cáº§u Quyá»n Truy Cáº­p</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #1e3c72, #2a5298);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    #requestAccess, #adminPanel, #content {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      max-width: 400px;
      text-align: center;
      user-select: none;
    }
    #requestAccess {
      display: block;
    }
    #adminPanel {
      display: none;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    button {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #fcd34d;
      color: #000;
      margin-top: 15px;
      user-select: none;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #eab308;
    }
    .access-item {
      background: rgba(255,255,255,0.2);
      margin: 5px 0;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      word-break: break-word;
    }
    .access-ip {
      flex: 1;
      text-align: left;
    }
    .approve-btn {
      background: #22c55e;
      color: white;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    .approve-btn:hover {
      background: #16a34a;
    }
    #content {
      display: none;
      max-width: 500px;
      padding: 2rem;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      color: #fcd34d;
    }
    .heart {
      font-size: 2rem;
      margin-top: 1rem;
      color: #f43f5e;
    }
  </style>
</head>
<body>

  <!-- NÃºt yÃªu cáº§u quyá»n truy cáº­p -->
  <div id="requestAccess">
    <h2>ğŸ”’ YÃŠU Cáº¦U QUYá»€N TRUY Cáº¬P</h2>
    <button id="requestBtn">Gá»­i yÃªu cáº§u</button>
    <p><small>Nháº¥n nÃºt Ä‘á»ƒ gá»­i yÃªu cáº§u truy cáº­p. Admin sáº½ duyá»‡t trong thá»i gian sá»›m nháº¥t.</small></p>
  </div>

  <!-- Báº£ng phÃª duyá»‡t cá»§a Admin (áº©n máº·c Ä‘á»‹nh, hiá»‡n khi nháº¥n P) -->
  <div id="adminPanel">
    <h3>ğŸ“‹ Báº£ng phÃª duyá»‡t truy cáº­p</h3>
    <div id="requestsList"></div>
    <p><small>Nháº¥n phÃ­m P Ä‘á»ƒ áº©n/hiá»‡n báº£ng nÃ y.</small></p>
  </div>

  <!-- Ná»™i dung xin lá»—i (hiá»‡n khi Ä‘Æ°á»£c phÃª duyá»‡t) -->
  <div id="content">
    <h1>Tá»› xin lá»—i...</h1>
    <p>
      Anh xin lá»—i vÃ¬ chuyá»‡n hÃ´m ná» nhÃ©. Anh khÃ´ng cá»‘ Ã½ Ä‘Ã¢u, táº¡i anh vÃ´ tÃ¢m quÃ¡. Mong em Ä‘á»«ng buá»“n ná»¯a nha!<br>
      Anh xin lá»—i vÃ¬ Ä‘Ã£ lÃ m em buá»“n. Anh nháº­n biáº¿t Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³ lÃ  sai rá»“i ..!
    </p>
    <div class="heart">ğŸ’”</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Cáº¥u hÃ¬nh Firebase (thay báº±ng cá»§a báº¡n)
    const firebaseConfig = {
      apiKey: "AIzaSyCtJtabQIwEl_lUO8vIpeQgp4OyMtcXjkw",
      authDomain: "login-a2878.firebaseapp.com",
      databaseURL: "https://login-a2878-default-rtdb.firebaseio.com",
      projectId: "login-a2878",
      storageBucket: "login-a2878.firebasestorage.app",
      messagingSenderId: "312148809641",
      appId: "1:312148809641:web:c77b295ada290ecc9156b8",
      measurementId: "G-7DRBRBRJHL"
    };

    // Khá»Ÿi táº¡o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const requestBtn = document.getElementById("requestBtn");
    const requestAccessDiv = document.getElementById("requestAccess");
    const adminPanel = document.getElementById("adminPanel");
    const requestsList = document.getElementById("requestsList");
    const contentDiv = document.getElementById("content");

    // LÆ°u IP ngÆ°á»i dÃ¹ng, tráº¡ng thÃ¡i duyá»‡t
    let userIP = null;
    let userKey = null; // key trong Firebase Ä‘á»ƒ theo dÃµi

    // Láº¥y IP ngÆ°á»i dÃ¹ng qua api.ipify.org
    async function getUserIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch {
        return "0.0.0.0";
      }
    }

    // Gá»­i IP lÃªn Firebase vÃ  Discord webhook
    async function sendRequest(ip) {
      // Táº¡o key má»›i trong DB
      const newKey = db.ref('requests').push().key;

      // Ghi request vá»›i tráº¡ng thÃ¡i pending (chÆ°a duyá»‡t)
      await db.ref('requests/' + newKey).set({
        ip: ip,
        approved: false,
        timestamp: Date.now()
      });

      userKey = newKey;

      // Gá»­i webhook Discord
      const webhookURL = "https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN"; // Thay webhook tháº­t vÃ o Ä‘Ã¢y
      const content = {
        content: `ğŸ“¢ NgÆ°á»i dÃ¹ng yÃªu cáº§u truy cáº­p:\nIP: ${ip}\nThá»i gian: ${new Date().toLocaleString()}`
      };
      try {
        await fetch(webhookURL, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(content)
        });
      } catch(e) {
        console.warn("KhÃ´ng gá»­i Ä‘Æ°á»£c webhook", e);
      }
    }

    // Hiá»ƒn thá»‹ yÃªu cáº§u truy cáº­p (admin)
    function renderRequests(data) {
      requestsList.innerHTML = "";
      if (!data) return;
      Object.entries(data).forEach(([key, val]) => {
        if (val.approved) return; // KhÃ´ng hiá»‡n request Ä‘Ã£ duyá»‡t
        const div = document.createElement("div");
        div.className = "access-item";

        const spanIP = document.createElement("div");
        spanIP.className = "access-ip";
        spanIP.textContent = val.ip;

        const btnApprove = document.createElement("button");
        btnApprove.className = "approve-btn";
        btnApprove.textContent = "PhÃª duyá»‡t";
        btnApprove.onclick = () => {
          db.ref('requests/' + key).update({ approved: true });
        };

        div.appendChild(spanIP);
        div.appendChild(btnApprove);
        requestsList.appendChild(div);
      });
    }

    // Kiá»ƒm tra tráº¡ng thÃ¡i duyá»‡t cá»§a user
    function watchApproval(key) {
      if (!key) return;
      const ref = db.ref('requests/' + key + '/approved');
      ref.on('value', snapshot => {
        if (snapshot.val() === true) {
          // ÄÆ°á»£c phÃª duyá»‡t
          requestAccessDiv.style.display = "none";
          contentDiv.style.display = "block";
        }
      });
    }

    // Xá»­ lÃ½ nÃºt yÃªu cáº§u quyá»n
    requestBtn.onclick = async () => {
      if (userKey) {
        alert("Báº¡n Ä‘Ã£ gá»­i yÃªu cáº§u rá»“i, vui lÃ²ng chá» admin phÃª duyá»‡t.");
        return;
      }
      userIP = await getUserIP();
      await sendRequest(userIP);
      watchApproval(userKey);
      alert("ÄÃ£ gá»­i yÃªu cáº§u, vui lÃ²ng chá» admin phÃª duyá»‡t.");
    };

    // Admin nháº¥n phÃ­m P Ä‘á»ƒ báº­t/táº¯t báº£ng phÃª duyá»‡t
    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === 'p') {
        if (adminPanel.style.display === "none") {
          adminPanel.style.display = "block";
        } else {
          adminPanel.style.display = "none";
        }
      }
    });

    // Láº¯ng nghe thay Ä‘á»•i requests realtime (dÃ nh cho admin)
    db.ref('requests').on('value', snapshot => {
      renderRequests(snapshot.val());
    });

  </script>

</body>
</html>
